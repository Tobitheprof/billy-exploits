import socketio

class BillyBetsClient:
    def __init__(self, server_url, session_id):
        """
        Initialize the BillyBetsClient with the server URL and session ID.
        :param server_url: The WebSocket server URL to connect to.
        :param session_id: A unique identifier for the user's session.
        """
        self.sio = socketio.Client()
        self.server_url = server_url
        self.session_id = session_id
        self._setup_event_handlers()

    def _setup_event_handlers(self):
        """
        Set up the Socket.IO event handlers for connection, response, and disconnection.
        """

        @self.sio.event
        def connect():
            """
            Handle connection established to the server.
            """
            print("Connection established")

        @self.sio.on('billy')
        def on_billy_response(data):
            """
            Handle the 'billy' event and print the response from the server.
            :param data: The data sent back by the server in response to a query.
            """
            print("Response from billy:", data)

        @self.sio.event
        def disconnect():
            """
            Handle server disconnection.
            """
            print("Disconnected from the server")

    def connect(self):
        """
        Connect to the WebSocket server.
        """
        self.sio.connect(self.server_url)

    def ask_question(self, question):
        """
        Emit a question to the server via the 'billy' event.
        :param question: The question to ask the server.
        """
        print(f"Asking: {question}")
        self.sio.emit('billy', {'message': {'message': question, 'session': self.session_id}})

    def wait_for_response(self):
        """
        Keep the connection alive to wait for a response from the server.
        """
        self.sio.wait()


if __name__ == "__main__":
    # Example usage
    billy_client = BillyBetsClient(server_url="https://billy1-351e65700982.herokuapp.com/", session_id="12345")
    
    # Connect to the server
    billy_client.connect()
    
    # Ask a question
    billy_client.ask_question('Who won the last NFL game?')

    # Wait for a response from the server
    billy_client.wait_for_response()
